<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸƒ Blackjack 21 è¦–è¦ºåŒ–æ¨¡æ“¬å™¨</title>
<style>
  :root{
    --bg:#0b2a2b;
    --card-bg:#fff;
    --card-text:#111;
    --accent:#ffd166;
    --muted:#a7c4c3;
  }
  body{
    margin:0;
    font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
    background: linear-gradient(180deg,var(--bg),#042427 150%);
    color: #eef7f6;
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;
    padding:20px;
  }
  h1{ margin:10px 0 6px; color:var(--accent); text-shadow:0 3px 8px rgba(0,0,0,0.6); }
  .table{
    width:100%;
    max-width:1000px;
    background: rgba(255,255,255,0.03);
    border-radius:12px;
    padding:18px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  }
  .top-row{ display:flex; gap:12px; align-items:center; justify-content:space-between; }
  .info{
    display:flex; gap:12px; align-items:center;
  }
  .chip{
    background:var(--accent);
    color:#041414;
    padding:6px 12px;
    border-radius:8px;
    font-weight:700;
  }
  .controls{ margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
  input[type=number]{ width:110px; padding:6px 10px; border-radius:8px; border:none; }
  button{
    background:var(--accent);
    color:#041414;
    border:none;
    padding:8px 14px;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 4px 10px rgba(0,0,0,0.4);
  }
  button:disabled{ opacity:0.5; cursor:not-allowed; }
  .board{ margin-top:18px; display:flex; gap:20px; flex-wrap:wrap; justify-content:space-between; align-items:flex-start; }
  .hand{
    width:calc(50% - 10px);
    min-height:220px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:10px;
    padding:12px;
    box-sizing:border-box;
  }
  .hand h3{ margin:0 0 8px 0; color:var(--muted); font-weight:600; font-size:14px;}
  .cards{ display:flex; gap:10px; min-height:120px; align-items:end; }
  .card{
    width:86px; height:120px; border-radius:8px; background:var(--card-bg); color:var(--card-text);
    display:flex; flex-direction:column; justify-content:space-between; padding:8px; box-shadow:0 8px 18px rgba(0,0,0,0.4);
    transform-origin:center center;
    transition: transform 350ms ease, opacity 300ms ease;
  }
  .card.small{ width:72px; height:96px; }
  .card .top, .card .bottom{ font-weight:700; font-size:18px; }
  .card .suit{ font-size:24px; text-align:center; opacity:0.9; }
  .score{ margin-top:10px; color:var(--accent); font-weight:800; }
  .log{ margin-top:14px; background:rgba(0,0,0,0.25); padding:10px; border-radius:8px; min-height:60px; font-size:14px; color:var(--muted) }
  .footer{ margin-top:16px; display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; color:var(--muted); font-size:13px }
  .history{ max-height:120px; overflow:auto; padding:8px; border-radius:8px; background:rgba(255,255,255,0.02); }
  .win { color:#b8ffb0; font-weight:800; }
  .lose { color:#ffb0b0; font-weight:800; }
  .push { color:#cfe9ff; font-weight:800; }
  @media (max-width:800px){
    .hand{ width:100%; }
  }
</style>
</head>
<body>

  <h1>ğŸƒ Blackjack 21 è¦–è¦ºåŒ–æ¨¡æ“¬å™¨</h1>

  <div class="table">
    <div class="top-row">
      <div class="info">
        <div class="chip">ç©å®¶ï¼šguest_001</div>
        <div id="balanceChip" class="chip">é¤˜é¡ $1000</div>
        <div style="color:var(--muted)">å±€æ•¸: <span id="roundCount">0</span></div>
      </div>

      <div>
        <label>ä¸‹æ³¨é‡‘é¡</label>
        <input id="betInput" type="number" min="1" value="50" />
        <button id="dealBtn">ç™¼ç‰Œ Deal</button>
        <button id="resetBtn">é‡ç½® Reset</button>
      </div>
    </div>

    <div class="board">
      <div class="hand" id="dealerArea">
        <h3>èŠå®¶ (Dealer)</h3>
        <div class="cards" id="dealerCards"></div>
        <div class="score" id="dealerScore">å¾—åˆ†: -</div>
      </div>

      <div class="hand" id="playerArea">
        <h3>ç©å®¶ (Player)</h3>
        <div class="cards" id="playerCards"></div>
        <div class="score" id="playerScore">å¾—åˆ†: -</div>
        <div style="margin-top:10px;">
          <button id="hitBtn" disabled>è¦ç‰Œ Hit</button>
          <button id="standBtn" disabled>åœç‰Œ Stand</button>
        </div>
      </div>
    </div>

    <div class="log" id="message">ç‹€æ…‹é¡¯ç¤ºåœ¨æ­¤ã€‚è«‹å…ˆä¸‹æ³¨ä¸¦æŒ‰ Deal é–‹å§‹ã€‚</div>

    <div class="footer">
      <div>
        çµæœç´€éŒ„:
        <div class="history" id="historyList"></div>
      </div>
      <div style="text-align:right">
        <div>è³ ç‡èªªæ˜: Blackjackï¼ˆç©å®¶ 21ï¼‰= 1.5xï¼›ä¸€èˆ¬å‹åˆ© = 1xï¼›å¹³æ‰‹ (push) é€€å›ä¸‹æ³¨</div>
      </div>
    </div>
  </div>

<script>
/*
  ç°¡å–® Blackjack é‚è¼¯ï¼ˆå–®å‰¯ç‰Œï¼ŒæŠ½å®Œå¯é‡æ–°æ´—ç‰Œï¼‰
  - A = 1 æˆ– 11ï¼ˆè‡ªå‹•è¨ˆç®—æœ€æ¥è¿‘ä½†ä¸è¶…é 21 çš„é»æ•¸ï¼‰
  - J,Q,K = 10
  - ç©å®¶å¯ Hit æˆ– Stand
  - èŠå®¶åœ¨ 17 ä»¥ä¸‹å¿…é ˆè£œç‰Œï¼ˆç°¡å–®è¦å‰‡ï¼‰
  - ç™¼ç”Ÿ Blackjackï¼ˆç©å®¶èµ·å§‹ç‰Œç‚º A+10ï¼‰å‰‡è¦–ç‚º Blackjack
  - payout: blackjack 1.5x, win 1x, push 0 (é€€é‚„)
  - æ‰€æœ‰é‹ç®—éƒ½åœ¨å‰ç«¯ï¼ˆæ•™å­¸ / æ¨¡æ“¬ç”¨é€”ï¼‰
*/

// å·¥å…·èˆ‡è³‡æ–™
const suits = ["â™ ","â™¥","â™¦","â™£"];
const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
let deck = [];
let playerHand = [];
let dealerHand = [];
let round = 0;
let balance = 1000;
let currentBet = 0;
let inRound = false;

// å…ƒç´ 
const dealerCardsEl = document.getElementById("dealerCards");
const playerCardsEl = document.getElementById("playerCards");
const dealerScoreEl = document.getElementById("dealerScore");
const playerScoreEl = document.getElementById("playerScore");
const messageEl = document.getElementById("message");
const dealBtn = document.getElementById("dealBtn");
const hitBtn = document.getElementById("hitBtn");
const standBtn = document.getElementById("standBtn");
const betInput = document.getElementById("betInput");
const balanceChip = document.getElementById("balanceChip");
const historyList = document.getElementById("historyList");
const roundCount = document.getElementById("roundCount");
const resetBtn = document.getElementById("resetBtn");

// åˆå§‹
updateBalanceUI();
shuffleDeck();

// äº‹ä»¶
dealBtn.addEventListener("click", onDeal);
hitBtn.addEventListener("click", onHit);
standBtn.addEventListener("click", onStand);
resetBtn.addEventListener("click", onReset);

// å»ºç«‹ç‰Œå †
function buildDeck(){
  const arr = [];
  for(let s of suits){
    for(let r of ranks){
      arr.push({suit:s, rank:r});
    }
  }
  return arr;
}
function shuffleDeck(){
  deck = buildDeck();
  for(let i = deck.length -1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [deck[i], deck[j]] = [deck[j], deck[i]];
  }
}

// ç™¼ä¸€å¼µç‰Œ
function draw(){
  if(deck.length ===0){
    shuffleDeck();
    messageEl.innerText = "ç‰Œå †å·²æ´—ç‰Œï¼ˆè‡ªå‹•é‡æ–°æ´—ï¼‰";
  }
  return deck.shift();
}

// è¨ˆç®—æ‰‹ç‰Œé»æ•¸ï¼ˆA è‡ªå‹• 1 æˆ– 11ï¼‰
function calcHandValue(hand){
  let total = 0;
  let aces = 0;
  for(const c of hand){
    if(c.rank === "A"){ aces++; total += 1; }
    else if(["J","Q","K"].includes(c.rank)){ total += 10; }
    else total += parseInt(c.rank);
  }
  // å°‡éƒ¨åˆ† A å¾1è½‰æˆ11ï¼ˆæ¯æ¬¡å¢åŠ 10ï¼‰åªè¦ä¸çˆ†ï¼ˆ<=21ï¼‰
  for(let i=0;i<aces;i++){
    if(total + 10 <= 21) total += 10;
  }
  return total;
}

// é¡¯ç¤ºå¡ç‰‡ï¼ˆç°¡æ½”è¦–è¦ºåŒ–ï¼‰
function renderHands(hideDealerHole=true){
  dealerCardsEl.innerHTML = "";
  playerCardsEl.innerHTML = "";

  // dealer
  for(let i=0;i<dealerHand.length;i++){
    const card = dealerHand[i];
    const el = createCardElement(card);
    // å¦‚æœæ˜¯èŠå®¶ç¬¬ä¸€å¼µï¼ˆhole cardï¼‰ä¸”è¦éš±è—
    if(i===1 && hideDealerHole && inRound){
      const hole = document.createElement("div");
      hole.className="card small";
      hole.style.background="#444";
      hole.style.color="#222";
      hole.style.opacity = "0.95";
      hole.innerHTML = "<div style='font-size:18px;text-align:center;margin-top:35px;color:#999'>ğŸ‚ </div>";
      dealerCardsEl.appendChild(hole);
    } else {
      dealerCardsEl.appendChild(el);
    }
  }

  // player
  for(const c of playerHand){
    playerCardsEl.appendChild(createCardElement(c));
  }

  // åˆ†æ•¸é¡¯ç¤º
  const pVal = calcHandValue(playerHand);
  const dVal = inRound ? "??" : calcHandValue(dealerHand);
  playerScoreEl.innerText = `å¾—åˆ†: ${pVal}`;
  dealerScoreEl.innerText = `å¾—åˆ†: ${dVal}`;
}

// å»ºç«‹å¡ç‰‡ DOM
function createCardElement(card){
  const el = document.createElement("div");
  el.className = "card small";
  // ç´…é»‘é¡è‰²
  const isRed = (card.suit === "â™¥" || card.suit === "â™¦");
  el.style.background = isRed ? "#fff0f0" : "#ffffff";
  el.style.color = isRed ? "#900" : "#111";
  el.innerHTML = `<div class="top">${card.rank}</div><div class="suit">${card.suit}</div><div class="bottom">${card.rank}</div>`;
  el.style.transform = `translateY(0px)`;
  el.style.opacity = "1";
  return el;
}

// ç©å®¶æŒ‰ Deal
function onDeal(){
  if(inRound){
    messageEl.innerText = "å›åˆé‚„åœ¨é€²è¡Œä¸­ï¼è«‹å…ˆå®Œæˆæœ¬å±€ã€‚";
    return;
  }
  currentBet = parseInt(betInput.value) || 0;
  if(currentBet <=0){ alert("è«‹è¼¸å…¥æœ‰æ•ˆä¸‹æ³¨é‡‘é¡"); return; }
  if(currentBet > balance){ alert("é¤˜é¡ä¸è¶³ï¼"); return; }

  // åˆå§‹åŒ–
  playerHand = [];
  dealerHand = [];
  inRound = true;
  round++;
  roundCount.innerText = round;

  // æ‰£æŠ¼æ³¨
  balance -= currentBet;
  updateBalanceUI();

  // ç™¼ç‰Œï¼š ç©å®¶ã€èŠå®¶ã€ç©å®¶ã€èŠå®¶ï¼ˆèŠå®¶ç¬¬äºŒå¼µç‚ºæš—ç‰Œï¼‰
  playerHand.push(draw());
  dealerHand.push(draw());
  playerHand.push(draw());
  dealerHand.push(draw());

  // æ›´æ–°ä»‹é¢
  renderHands(true);

  // æª¢æŸ¥ Blackjackï¼ˆç©å®¶æˆ–èŠå®¶ï¼‰
  const pVal = calcHandValue(playerHand);
  const dVal = calcHandValue(dealerHand);

  if(pVal === 21){
    // ç©å®¶ blackjack
    // ç«‹åˆ»æ¯”å°èŠå®¶æ˜¯å¦ä¹Ÿblackjack
    if(dVal === 21){
      endRound("push");
    } else {
      endRound("player_blackjack");
    }
  } else if(dVal === 21){
    // èŠå®¶ blackjack ä¸”ç©å®¶é blackjack
    endRound("dealer_blackjack");
  } else {
    // æ­£å¸¸æµç¨‹ï¼Œå•Ÿç”¨æŒ‰éˆ•
    hitBtn.disabled = false;
    standBtn.disabled = false;
    dealBtn.disabled = true;
    messageEl.innerText = "è«‹é¸æ“‡è¦ç‰Œï¼ˆHitï¼‰æˆ–åœç‰Œï¼ˆStandï¼‰ã€‚";
  }
}

// ç©å®¶æŒ‰ Hit
function onHit(){
  if(!inRound) return;
  playerHand.push(draw());
  renderHands(true);
  const pVal = calcHandValue(playerHand);
  if(pVal > 21){
    endRound("player_bust");
  } else if(pVal === 21){
    // è‡ªå‹• Stand
    onStand();
  } else {
    messageEl.innerText = "ä½ è¦ç‰Œäº†ã€‚";
  }
}

// ç©å®¶æŒ‰ Stand
function onStand(){
  if(!inRound) return;
  hitBtn.disabled = true;
  standBtn.disabled = true;
  messageEl.innerText = "èŠå®¶è£œç‰Œä¸­...";
  // æ­éœ²èŠå®¶æš—ç‰Œä¸¦è®“èŠå®¶ä¾è¦å‰‡è£œç‰Œ
  renderHands(false);
  setTimeout(()=> dealerPlay(), 800);
}

// èŠå®¶è£œç‰Œè¦å‰‡
function dealerPlay(){
  let dVal = calcHandValue(dealerHand);
  // èŠå®¶åœ¨ 16 æˆ–æ›´å°è¦è£œç‰Œï¼Œ17ï¼ˆåŒ…å«è»Ÿ 17ï¼‰å‰‡åœï¼ˆæ­¤ç‚ºç°¡åŒ–è¦å‰‡ï¼‰
  while(dVal < 17){
    dealerHand.push(draw());
    renderHands(false);
    dVal = calcHandValue(dealerHand);
  }
  // åˆ¤å®šè¼¸è´
  const pVal = calcHandValue(playerHand);
  if(dVal > 21){
    endRound("dealer_bust");
  } else {
    // æ¯”è¼ƒå¤§å°
    if(pVal > dVal) endRound("player_win");
    else if(pVal < dVal) endRound("dealer_win");
    else endRound("push");
  }
}

// çµæŸå›åˆ
function endRound(code){
  inRound = false;
  hitBtn.disabled = true;
  standBtn.disabled = true;
  dealBtn.disabled = false;
  renderHands(false);
  let resultText = "";
  let payout = 0;

  switch(code){
    case "player_blackjack":
      // Blackjack 1.5xï¼šè´å¾—ä¸‹æ³¨ * 1.5ï¼ˆå«æœ¬é‡‘ï¼‰
      payout = Math.floor(currentBet * 2.5); // å›å‚³åŒ…å«æœ¬é‡‘ã€‚æ³¨æ„ï¼šé€™è£¡ç”¨æ•´æ•¸ mathã€‚å¯¦å‹™å¯ç”¨å°æ•¸ã€‚
      balance += payout;
      resultText = `ç©å®¶ Blackjackï¼è´å¾— $${payout} (å«æœ¬é‡‘)ã€‚`;
      pushHistory("Blackjack", currentBet, payout, "player");
      break;
    case "dealer_blackjack":
      resultText = "èŠå®¶ Blackjackï¼Œç©å®¶è¼¸ã€‚";
      pushHistory("Dealer Blackjack", currentBet, 0, "dealer");
      break;
    case "player_bust":
      resultText = "ç©å®¶é»æ•¸çˆ†æ‰ (Bust)ï¼Œç©å®¶è¼¸ã€‚";
      pushHistory("Player Bust", currentBet, 0, "dealer");
      break;
    case "dealer_bust":
      payout = currentBet * 2;
      balance += payout;
      resultText = `èŠå®¶çˆ†æ‰ï¼Œç©å®¶è´ï¼ç²å¾— $${payout}`;
      pushHistory("Dealer Bust", currentBet, payout, "player");
      break;
    case "player_win":
      payout = currentBet * 2;
      balance += payout;
      resultText = `ç©å®¶é»æ•¸è¼ƒé«˜ï¼Œç©å®¶è´ï¼ç²å¾— $${payout}`;
      pushHistory("Player Win", currentBet, payout, "player");
      break;
    case "dealer_win":
      resultText = "èŠå®¶é»æ•¸è¼ƒé«˜ï¼Œç©å®¶è¼¸ã€‚";
      pushHistory("Dealer Win", currentBet, 0, "dealer");
      break;
    case "push":
      // å¹³æ‰‹ï¼Œé€€é‚„ä¸‹æ³¨
      balance += currentBet;
      resultText = "å¹³æ‰‹ (Push)ï¼Œé€€é‚„ä¸‹æ³¨ã€‚";
      pushHistory("Push", currentBet, currentBet, "push");
      break;
    default:
      resultText = "æœªçŸ¥çµæœ";
      break;
  }

  currentBet = 0;
  updateBalanceUI();
  messageEl.innerText = resultText;
}

// æ¨é€åˆ°æ­·å²ç´€éŒ„ï¼ˆç•«é¢ï¼‰
function pushHistory(title, bet, payout, winner){
  const el = document.createElement("div");
  const cls = winner === "player" ? "win" : (winner==="dealer" ? "lose" : "push");
  el.innerHTML = `<strong class="${cls}">${title}</strong> â€” ä¸‹æ³¨ $${bet}ï¼Œçµæœ $${payout}`;
  historyList.prepend(el);
}

// æ›´æ–°é¤˜é¡é¡¯ç¤º
function updateBalanceUI(){
  balanceChip.innerText = `é¤˜é¡ $${balance}`;
  // å„²å­˜ LocalStorageï¼ˆç°¡æ˜“ä¿æŒï¼‰
  localStorage.setItem("bj_balance", String(balance));
}

// é‡ç½®ï¼ˆæ¢å¾©åˆå§‹ï¼‰
function onReset(){
  if(!confirm("ç¢ºå®šè¦é‡ç½®éŠæˆ²ï¼Ÿé€™æœƒæŠŠé¤˜é¡å›åˆ° 1000ã€‚")) return;
  balance = 1000;
  round = 0;
  historyList.innerHTML = "";
  playerHand = [];
  dealerHand = [];
  deck = [];
  shuffleDeck();
  updateBalanceUI();
  renderHands(false);
  messageEl.innerText = "éŠæˆ²å·²é‡ç½®ã€‚";
  roundCount.innerText = "0";
}

// é é¢è¼‰å…¥æ™‚å˜—è©¦è®€å– LocalStorageï¼ˆé‡‘é¡ï¼‰
window.addEventListener("load", ()=>{
  const saved = Number(localStorage.getItem("bj_balance") || "0");
  if(saved > 0) balance = saved;
  updateBalanceUI();
  renderHands(false);
});
</script>

</body>
</html>
